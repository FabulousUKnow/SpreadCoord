<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mapfinder</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap.min.css">
    <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" language="javascript"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" language="javascript"
        src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" language="javascript"
        src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap.min.js"></script>
</head>

<body>
    <div class="container mt-2 text-white">
        <div class="row mb-3">
            <div class="col-12">
                <div class="row">
                    <div class="form-group col-3">
                        <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Coord</label>
                        <input type="number" id="cx" size="4" disabled value="0" style="width: 56px;" />
                        <input type="number" id="cy" size="4" disabled value="0" style="width: 56px;" />
                        <label>Zones</label>
                        <input type="number" id="count" size="4" disabled value="0" style="width: 56px;" />
                        Zone :
                        <input type="radio" id="crystalzone" onclick="location.href='#tab-crystal';" name="zonetype"
                            value="crystal" checked><label for="crystalzone">Crystal</label>
                        <input type="radio" id="small" name="zonetype" value="small"><label for="small">Small</label>
                        <input type="radio" id="medium" name="zonetype" value="medium"><label
                            for="medium">Medium</label>
                        <input type="radio" id="playersearch" name="zonetype" value="medium"><label
                            for="playersearch">Player</label>

                        <button class="mb-2 btn btn-primary w-100 click" id="find" onclick="find();">Find</button>
                        <br>
                        <label>Websocket :</label>
                        <input type="number" size="2" id="wss" disabled value="0" style="width: 50px;" />
                        <label>Value :</label>
                        <input type="number" size="4" id="cvalue" style="width: 70px;" />

                    </div>
                </div>
            </div>
        </div>
        <div>
            <ul class="nav nav-tabs" role="tablist">
                <li id="crystalli" class="active">
                    <a href="#tab-crystal" data-toggle="tab">Crystal</a>
                </li>
                <li>
                    <a href="#tab-goblin" data-toggle="tab">Goblin</a>
                </li>


                <li>
                    <a href="#tab-charm" data-toggle="tab">Charms</a>
                </li>
                <li>
                    <a href="#tab-monster" data-toggle="tab">Monsters</a>
                </li>
                <li>
                    <a href="#tab-mine" data-toggle="tab">Mines</a>
                </li>
                <li>
                    <a href="#tab-dk" data-toggle="tab">DK</a>
                </li>
                <li>
                    <a href="#tab-player" data-toggle="tab">Player</a>
                </li>
                <li id="setup">
                    <a href="#tab-setup" data-toggle="tab">Setup</a>
                </li>
                <li id="logtab">
                    <a href="#tab-log" data-toggle="tab">Log</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="tab-crystal">
                    <table id="crystal" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                                <th>Invisible</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-goblin">
                    <table id="goblin" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                                <th>Invisible</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>


                <div class="tab-pane" id="tab-charm">
                    <table id="charm" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-monster">
                    <table id="monster" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                                <th>Invisible</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-mine">
                    <table id="mine" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                                <th>Invisible</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-dk">
                    <table id="dk" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Type</th>
                                <th>Value</th>
                                <th>Location</th>
                                <th>Distance</th>
                                <th>Invisible</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-player">
                    <table id="player" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Kingdom</th>
                                <th>Alliance</th>
                                <th>Player ID</th>
                                <th>Location</th>
                                <th>Shield</th>
                                <th>Distance</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <!-- javascript -->
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="tab-setup">
                    <label>Coord X :</label>
                    <input type="number" class="" id="x" />
                    <label>Coord Y :</label>
                    <input type="number" class="" id="y" />
                    <br>

                    <br>
                    <label>token :</label>
                    <textarea rows="5" cols=75% id="token"></textarea>
                    <br><br>
                    <button class="mb-2 btn btn-primary w-100" id="saveSetup" onclick="">Save</button>
                    <br>
                    <button class="mb-2 btn btn-primary w-100" id="clear" onclick="">Clear</button>
                </div>
                <div class="tab-pane" id="tab-log">
                    <div id="log-container">
                        <pre id="log"></pre>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">

            $(document).ready(function () {
                wss = 0;
                $("#x").val(JSON.parse(localStorage.getItem('x')));
                $("#y").val(JSON.parse(localStorage.getItem('y')));
                $("#cx").val($("#x").val())
                $("#cy").val($("#y").val())
                $("#token").val(localStorage.getItem('token'));
                $("#slots").val(localStorage.getItem('slots'));
                $("#dist").val(localStorage.getItem('dist'));
                $("#wss").val(wss)
                $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                    $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
                });

                $('#charm thead tr')
                    .clone(true)
                    .addClass('filters')
                    .appendTo('#charm thead');
                charmid = $('#charm').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.filters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.filters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });
                $('#monster thead tr')
                    .clone(true)
                    .addClass('monsterfilters')
                    .appendTo('#monster thead');
                monsterid = $('#monster').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.monsterfilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.monsterfilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });

                $('#player thead tr')
                    .clone(true)
                    .addClass('playerfilters')
                    .appendTo('#player thead');
                playerid = $('#player').DataTable({
                    order: [[4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.playerfilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.playerfilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });
                $('#crystal thead tr')
                    .clone(true)
                    .addClass('crystalfilters')
                    .appendTo('#crystal thead');
                crystalid = $('#crystal').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.crystalfilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.crystalfilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });
                $('#goblin thead tr')
                    .clone(true)
                    .addClass('goblinfilters')
                    .appendTo('#goblin thead');
                goblinid = $('#goblin').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.goblinfilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.goblinfilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });
                $('#mine thead tr')
                    .clone(true)
                    .addClass('minefilters')
                    .appendTo('#mine thead');
                mineid = $('#mine').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.minefilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.minefilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });
                $('#dk thead tr')
                    .clone(true)
                    .addClass('dkfilters')
                    .appendTo('#dk thead');
                dkid = $('#dk').DataTable({
                    order: [[0, "desc"], [4, "asc"]],
                    iDisplayLength: 100,
                    orderCellsTop: true,
                    fixedHeader: true, dom: 'lrt', paging: false,
                    initComplete: function () {
                        var api = this.api();

                        // For each column
                        api
                            .columns()
                            .eq(0)
                            .each(function (colIdx) {
                                // Set the header cell to contain the input element
                                var cell = $('.dkfilters th').eq(
                                    $(api.column(colIdx).header()).index()
                                );
                                var title = $(cell).text();
                                $(cell).html('<input type="text" placeholder="' + title + '" />');

                                // On every keypress in this input
                                $(
                                    'input',
                                    $('.dkfilters th').eq($(api.column(colIdx).header()).index())
                                )
                                    .off('keyup change')
                                    .on('keyup change', function (e) {
                                        e.stopPropagation();

                                        // Get the search value
                                        $(this).attr('title', $(this).val());
                                        var regexr = '({search})'; //$(this).parents('th').find('select').val();

                                        var cursorPosition = this.selectionStart;
                                        // Search the column for that value
                                        api
                                            .column(colIdx)
                                            .search(
                                                this.value != ''
                                                    ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                    : '',
                                                this.value != '',
                                                this.value == ''
                                            )
                                            .draw();

                                        $(this)
                                            .focus()[0]
                                            .setSelectionRange(cursorPosition, cursorPosition);
                                    });
                            });
                    },
                });


                // Apply a search to the second table for the demo
                //$('#myTable2').DataTable().search( 'New York' ).draw();
            });
            document.getElementById("find").innerHTML = "Initiate websocket ...";
            var webSocket = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket2 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket3 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket4 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket5 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket6 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket7 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket8 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket9 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );
            var webSocket1 = new WebSocket(
                "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
            );

            keepid = setTimeout("keepConnect()", 10000);

            $("#cvalue").val(100)
            let j = 0;
            let zonesA = "";
            t = 8;
            item = 10101049;
            slot = 0;
            ap = 0;
            eco = 0;
            if (localStorage.getItem("updateMap") === null) {
                updateMap = 0;
            }
            else {
                updateMap = localStorage.getItem("updateMap");
            }
            goblinlvl = 4;
            dklvl = 4;
            monsterlvl = 6;
            minelvl = 6;
            ke = 0;
            lastResponse = 0;
            ws = 1; ws1 = 1; ws2 = 1; ws3 = 1; ws4 = 1; ws5 = 1; ws6 = 1; ws7 = 1; ws8 = 1; ws9 = 1;
            minepvp = 0;
            playerlvl = 31;
            playerid = "";
            tw = 200;
            $("#wss").val(0)
            charmlvl = 3;
            mapRefresh = 0;
            rallyJoined = [];
            lastrallycheck = 0;
            fieldslot = [];
            time = 0;
            dmaxSpar = 100;
            lastmarchcheck = 0;
            march = 9;
            clearid = 0;
            timeid = 0;
            lastapcheck = 0;
            lasthelpcheck = 0;
            lastharvestcheck = 0;
            mapmarchs = 0;
            let zones = new Array(t);
            webSocket.addEventListener('open', (event) => {
                initWS(webSocket);
            });

            webSocket.onmessage = function (event) {
                readWebSocket(0);
            };

            webSocket.onclose = function (event) {
                console.log('disconnected ');
                $("#wss").val(--wss)
            };
            webSocket2.addEventListener('open', (event) => {
                initWS(webSocket2);
            });

            webSocket2.onmessage = function (event) {
                readWebSocket(2);
            };

            webSocket2.onclose = function (event) {
                console.log('disconnected 2');
                $("#wss").val(--wss)
            };

            webSocket3.addEventListener('open', (event) => {
                initWS(webSocket3);
            });

            webSocket3.onmessage = function (event) {
                readWebSocket(3);
            };

            webSocket3.onclose = function (event) {
                console.log('disconnected 3');
                $("#wss").val(--wss)

            };

            webSocket4.addEventListener('open', (event) => {
                initWS(webSocket4);
            });

            webSocket4.onmessage = function (event) {
                readWebSocket(4);
            };

            webSocket4.onclose = function (event) {
                console.log('disconnected 4');
                $("#wss").val(--wss)
            };
            webSocket5.addEventListener('open', (event) => {
                initWS(webSocket5);
            });

            webSocket5.onmessage = function (event) {
                readWebSocket(5);
            };

            webSocket5.onclose = function (event) {
                console.log('disconnected 5');
                $("#wss").val(--wss)
            };
            //zone
            webSocket1.addEventListener('open', (event) => {
                initWS(webSocket1);
                document.getElementById("find").innerHTML = "Find";
            });

            webSocket1.onmessage = function (event) {
                readWebSocket(1);
            };

            webSocket1.onclose = function (event) {
                console.log('disconnected 1');
                $("#wss").val(--wss)
            };
            //zone
            webSocket6.addEventListener('open', (event) => {
                initWS(webSocket6);

            });

            webSocket6.onmessage = function (event) {
                readWebSocket(6);
            };

            webSocket6.onclose = function (event) {
                console.log('disconnected 6');
                $("#wss").val(--wss)
            };
            //zone
            webSocket7.addEventListener('open', (event) => {
                initWS(webSocket7);

            });

            webSocket7.onmessage = function (event) {
                readWebSocket(7);
            };

            webSocket7.onclose = function (event) {
                console.log('disconnected 7');
                $("#wss").val(--wss)
            };
            //zone
            webSocket8.addEventListener('open', (event) => {
                initWS(webSocket8);

            });

            webSocket8.onmessage = function (event) {
                readWebSocket(8);
            };

            webSocket8.onclose = function (event) {
                console.log('disconnected 8');
                $("#wss").val(--wss)
            };
            //zone
            webSocket9.addEventListener('open', (event) => {
                initWS(webSocket9);

            });

            webSocket9.onmessage = function (event) {
                readWebSocket(9);
            };

            webSocket9.onclose = function (event) {
                console.log('disconnected 9');
                $("#wss").val(--wss)
            };

            function readWebSocket(iws) {

                const x = $("#x").val();
                const y = $("#y").val();
                const monsters = $("#monster").DataTable();
                const players = $("#player").DataTable();
                const charms = $("#charm").DataTable();
                const mines = $("#mine").DataTable();
                const dk = $("#dk").DataTable();
                const goblins = $("#goblin").DataTable();
                const crystal = $("#crystal").DataTable();
                $('#monster tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#player tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#charm tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#mine tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#dk tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#goblin tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });
                $('#crystal tbody').on('click', 'tr', function () {
                    $(this).toggleClass('selected');
                });

                if (event.data.includes("/field/enter")) {
                    if (iws == 0) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 1) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 2) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 3) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 4) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 5) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 6) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 7) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 8) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                    if (iws == 9) { console.log("Websocket ", iws, " Connected and ready"); $("#wss").val(++wss) }
                }
                if (event.data.includes("/field/objects")) {
                    lastResponse = Math.floor(Date.now() / 1000)
                    if (iws == 0) { ws = 1 }
                    if (iws == 1) { ws1 = 1 }
                    if (iws == 2) { ws2 = 1 }
                    if (iws == 3) { ws3 = 1 }
                    if (iws == 4) { ws4 = 1 }
                    if (iws == 5) { ws5 = 1 }
                    if (iws == 6) { ws6 = 1 }
                    if (iws == 7) { ws7 = 1 }
                    if (iws == 8) { ws8 = 1 }
                    if (iws == 9) { ws9 = 1 }


                    //console.log("timeout reset");
                    /*clearTimeout(keepid);
                    keepid = setTimeout("keepConnect()", 10000);*/
                    const json = JSON.parse(
                        event.data.substring(20, event.data.length - 1)
                    );

                    let maj = 1;
                    eco = 1;
                    /*if (localStorage.getItem("341:1014") != 1 && localStorage.getItem("1390:363") != 1) {
                        maj = 1;
                    }*/
                    json.objects.map((object) => {



                        if ((object.code == 20400301 || object.code == 20400401 || object.code == 20400201) && mapRefresh == 1) { //shrines


                            //1149:637 1149:643 1155:643 1155:637 = 1152:640
                            // if (x <= 1149 && y == )
                            ccx = object.loc[1]
                            ccy = object.loc[2]
                            coordid = ccx + ":" + ccy;
                            localStorage.setItem(coordid, 1);
                            if ("1006:1405" == coordid) {
                                console.log("Ajout Shrine real: ", coordid)
                            }
                            for (let ci = 0; ci <= 3; ci++) {
                                cix = ccx + ci;
                                for (let cj = 0; cj <= 3; cj++) {
                                    cjy = ccy + cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Shrine: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 3; ci++) {
                                cix = ccx - ci;
                                for (let cj = 0; cj <= 3; cj++) {
                                    cjy = ccy - cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Shrine: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 3; ci++) {
                                cix = ccx + ci;
                                for (let cj = 0; cj <= 3; cj++) {
                                    cjy = ccy - cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Shrine: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 3; ci++) {
                                cix = ccx - ci;
                                for (let cj = 0; cj <= 3; cj++) {
                                    cjy = ccy + cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Shrine: ", cix, cjy)
                                    }
                                }
                            }
                            if ("1006:1405" == coordid) {
                                console.log("Ajout joueur:", coordid, 3)
                            }
                        }

                        if ((object.code == 20400101) && mapRefresh == 1) { //congress
                            //1149:637 1149:643 1155:643 1155:637 = 1152:640
                            // if (x <= 1149 && y == )
                            ccx = object.loc[1]
                            ccy = object.loc[2]
                            coordid = ccx + ":" + ccy;
                            localStorage.setItem(coordid, 1);
                            if ("1006:1405" == coordid) {
                                console.log("Ajout Congress real: ", coordid)
                            }
                            for (let ci = 0; ci <= 4; ci++) {
                                cix = ccx + ci;
                                for (let cj = 0; cj <= 4; cj++) {
                                    cjy = ccy + cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Congress: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 4; ci++) {
                                cix = ccx - ci;
                                for (let cj = 0; cj <= 4; cj++) {
                                    cjy = ccy - cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Congress: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 4; ci++) {
                                cix = ccx + ci;
                                for (let cj = 0; cj <= 4; cj++) {
                                    cjy = ccy - cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Congress: ", cix, cjy)
                                    }
                                }
                            }
                            for (let ci = 0; ci <= 4; ci++) {
                                cix = ccx - ci;
                                for (let cj = 0; cj <= 4; cj++) {
                                    cjy = ccy + cj;
                                    coordid = cix + ":" + cjy;
                                    localStorage.setItem(coordid, 1);
                                    if ("1006:1405" == coordid) {
                                        console.log("Ajout Congress: ", cix, cjy)
                                    }
                                }
                            }
                            if ("1006:1405" == coordid) {
                                console.log("Ajout joueur:", coordid, 3)
                            }

                        }
                        if ((object.code == 20600101) && mapRefresh == 1) { //Alliance center
                            if (object.occupied.allianceTag == "GoL1" || object.occupied.allianceTag == "GoL2" || object.occupied.allianceTag == "GoLf" || object.occupied.allianceTag == "SPW1" || object.occupied.allianceTag == "SPWf" || object.occupied.allianceTag == "YGG0" || object.occupied.allianceTag == "YGG1" || object.occupied.allianceTag == "Tama" || object.occupied.allianceTag == "JPN2" || object.occupied.allianceTag == "CvC1" || object.occupied.allianceTag == "FORE" || object.occupied.allianceTag == "onio" || object.occupied.allianceTag == "DeFi") {

                                //1149:637 1149:643 1155:643 1155:637 = 1152:640
                                // if (x <= 1149 && y == )
                                ccx = object.loc[1]
                                ccy = object.loc[2]
                                coordid = ccx + ":" + ccy;
                                localStorage.setItem(coordid, 1);
                                //console.log("Ajout Alliance center real: ", coordid)
                                for (let ci = 0; ci <= 12; ci++) {
                                    cix = ccx + ci;
                                    for (let cj = 0; cj <= 12; cj++) {
                                        cjy = ccy + cj;
                                        coordid = cix + ":" + cjy;
                                        localStorage.setItem(coordid, 1);
                                        if ("1006:1405" == coordid) {
                                            console.log("Ajout Alliance center: ", cix, cjy)
                                        }
                                    }
                                }
                                for (let ci = 0; ci <= 11; ci++) {
                                    cix = ccx - ci;
                                    for (let cj = 0; cj <= 11; cj++) {
                                        cjy = ccy - cj;
                                        coordid = cix + ":" + cjy;
                                        localStorage.setItem(coordid, 1);
                                        if ("1006:1405" == coordid) {
                                            console.log("Ajout Alliance center: ", cix, cjy)
                                        }
                                    }
                                }
                                for (let ci = 0; ci <= 12; ci++) {
                                    cix = ccx + ci;
                                    for (let cj = 0; cj <= 12; cj++) {
                                        cjy = ccy - cj;
                                        coordid = cix + ":" + cjy;
                                        localStorage.setItem(coordid, 1);
                                        if ("1006:1405" == coordid) {
                                            console.log("Ajout Alliance center: ", cix, cjy)
                                        }
                                    }
                                }
                                for (let ci = 0; ci <= 11; ci++) {
                                    cix = ccx - ci;
                                    for (let cj = 0; cj <= 11; cj++) {
                                        cjy = ccy + cj;
                                        coordid = cix + ":" + cjy;
                                        localStorage.setItem(coordid, 1);
                                        //console.log("Ajout Alliance center: ", cix, cjy)
                                    }
                                }
                                if ("1006:1405" == coordid) {
                                    console.log("Ajout joueur:", coordid, 3)
                                }
                            }
                        }
                        if (object.occupied && object.occupied.id == "61ddc59f2b3a9343de07466f" && object.code == 20100105) {
                            //console.log("megrez", object.occupied.name, object.level, object.loc[1], object.loc[2])
                        }
                        if (object.occupied && object.occupied.id == "61e403a45c44bf7c01f6e69f" && object.code == 20100105) {
                            //console.log("hadi", object.occupied.name, object.level, object.loc[1], object.loc[2])
                        }
                        if (object.occupied && object.occupied.id == "61e2d51fbabcec19484b43ac" && object.code == 20100105) {
                            //console.log("Musty", object.occupied.name, object.level, object.loc[1], object.loc[2])
                        }

                        if (!object.occupied) {
                            //if (object.loc[1] > 1200 && object.loc[2] < 2000 && object.loc[1] < 1600 && object.loc[2] > 1200) {

                            let d = 0;
                            d = distance(x, y, object.loc[1], object.loc[2]);
                            let type = "";
                            let value = 0;


                            if (object.param.charmCode && object.level >= charmlvl) {
                                if (d < 1500 || object.level >= 4) {
                                    if (
                                        object.param.charmCode > 100 &&
                                        object.param.charmCode < 105
                                    ) {
                                        type = "Harvester";
                                    }
                                    if (
                                        object.param.charmCode > 1300 &&
                                        object.param.charmCode < 1305
                                    ) {
                                        type = "Energy";
                                    }
                                    if (
                                        object.param.charmCode > 600 &&
                                        object.param.charmCode < 605
                                    ) {
                                        type = "Ressource";
                                    }
                                    if (
                                        object.param.charmCode > 1000 &&
                                        object.param.charmCode < 1005
                                    ) {
                                        type = "Attacker";
                                    }
                                    if (
                                        object.param.charmCode > 900 &&
                                        object.param.charmCode < 905
                                    ) {
                                        type = "Stamina";
                                    }
                                    if (
                                        object.param.charmCode > 1400 &&
                                        object.param.charmCode < 1405
                                    ) {
                                        type = "Defender";
                                    }
                                    if (
                                        object.param.charmCode > 700 &&
                                        object.param.charmCode < 705
                                    ) {
                                        type = "Builder";
                                    }
                                    if (
                                        object.param.charmCode > 400 &&
                                        object.param.charmCode < 405
                                    ) {
                                        type = "Gold";
                                    }
                                    if (
                                        object.param.charmCode > 300 &&
                                        object.param.charmCode < 305
                                    ) {
                                        type = "Stone";
                                    }
                                    if (
                                        object.param.charmCode > 200 &&
                                        object.param.charmCode < 205
                                    ) {
                                        type = "Lumber";
                                    }
                                    if (
                                        object.param.charmCode > 500 &&
                                        object.param.charmCode < 505
                                    ) {
                                        type = "Scholar";
                                    }
                                    if (
                                        object.param.charmCode > 800 &&
                                        object.param.charmCode < 805
                                    ) {
                                        type = "Trainer";
                                    }
                                    if (
                                        object.param.charmCode > 1200 &&
                                        object.param.charmCode < 1205
                                    ) {
                                        type = "Load";
                                    }
                                    if (
                                        object.param.charmCode > 1100 &&
                                        object.param.charmCode < 1105
                                    ) {
                                        type = "Speed";
                                    }
                                    charms.row
                                        .add([
                                            `${object.level}`,
                                            `${type}`,
                                            `${value}`,
                                            `${object.loc[1]} ${object.loc[2]}`,
                                            d,
                                        ])
                                        .draw();
                                }
                            }
                            if (((object.code > 20100100 && object.code <= 20100105) || (object.code > 20700600 && object.code <= 20700605)) && object.level >= minelvl) {
                                if (object.code == 20100101 || object.code == 20700601) {
                                    type = "Food"
                                }
                                if (object.code == 20100103 || object.code == 20700603) {
                                    type = "Stone"
                                }
                                if (object.code == 20100104 || object.code == 20700604) {
                                    type = "Gold"
                                }
                                if (object.code == 20100102 || object.code == 20700602) {
                                    type = "Wood"
                                }
                                let inv = 0;
                                let coordidc = "";
                                coordidc = object.loc[1] + ":" + object.loc[2];
                                if (localStorage.getItem(coordidc) == 1) {
                                    inv = 1;
                                }
                                area = 0;
                                if (821 > object.loc[1] && 1377 < object.loc[2]) {
                                    //area = 1;
                                }
                                if (inv == 0) {
                                    d = distance(x, y, object.loc[1], object.loc[2]);
                                    if (eco != 0) {
                                        mines.row
                                            .add([
                                                `${object.level}`,
                                                `${type}`,
                                                `${object.param.value}`,
                                                `${object.loc[1]} ${object.loc[2]}`,
                                                d,
                                                area,
                                            ])
                                            .draw();
                                    }
                                }

                            }
                            if (((object.code > 20200100 && object.code <= 20200105) || (object.code > 20700400 && object.code <= 20700409)) && (object.level >= monsterlvl && d < 1700)) {

                                if (object.code == 20200103) {
                                    type = "Golem"
                                }
                                if (object.code == 20200102) {
                                    type = "Skeleton"
                                }
                                if (object.code == 20200101) {
                                    type = "Orc"
                                }
                                if (object.code == 20700405) {
                                    type = "Ogre"
                                }
                                if (object.code == 20700407) {
                                    type = "Cyclope"
                                }
                                if (object.code == 20700406) {
                                    type = "Wolf"
                                }
                                let inv = 0;
                                let coordidc = "";
                                coordidc = object.loc[1] + ":" + object.loc[2];
                                if (localStorage.getItem(coordidc) == 1) {
                                    inv = 1;
                                }
                                area = 0;
                                /*if (821 > object.loc[1] && 1377 < object.loc[2]) {
                                    area = 1;
                                }*/
                                if (inv == 0) {
                                    if (eco != 0) {
                                        monsters.row
                                            .add([
                                                `${object.level}`,
                                                `${type}`,
                                                `${object.param.value}`,
                                                `${object.loc[1]} ${object.loc[2]}`,
                                                d,
                                                area
                                            ])
                                            .draw();
                                    }
                                }

                            }
                            if ((object.code == 20700506 || object.code == 20200201 || object.code == 20700505) && d < 800 && object.level > dklvl) {
                                //if (object.loc[1] >= 1600 && object.loc[2] > 1600) {

                                if (d < dmaxSpar) {
                                    dmaxSpari = 1;
                                }
                                let inv = 0;
                                let coordidc = "";
                                coordidc = object.loc[1] + ":" + object.loc[2];
                                if (localStorage.getItem(coordidc) == 1) {
                                    inv = 1;
                                }
                                if (object.code == 20700506) {
                                    type = "Spartoi"
                                }
                                if (object.code == 20200201) {
                                    type = "DK"
                                }
                                if (inv == 0) {
                                    if (eco != 0) {
                                        dk.row
                                            .add([
                                                `${object.level}`,
                                                `${type}`,
                                                `${object.param.value}`,
                                                `${object.loc[1]} ${object.loc[2]}`,
                                                d,
                                                inv
                                            ])
                                            .draw();
                                    }
                                }
                                //}
                            }

                            if (object.code == 20200104 && object.param.value > 0 && object.level >= goblinlvl) {

                                type = "Goblin";
                                let d = 0;
                                let inv = 0;
                                let coordidc = "";
                                coordidc = object.loc[1] + ":" + object.loc[2];
                                if (localStorage.getItem(coordidc) == 1) {
                                    inv = 1;
                                }
                                area = 0;
                                if (821 > object.loc[1] && 1377 < object.loc[2]) {
                                    //area = 1;
                                }
                                if (inv == 0) {
                                    d = distance(x, y, object.loc[1], object.loc[2]);
                                    goblins.row
                                        .add([
                                            `${object.level}`,
                                            `${type}`,
                                            `${object.param.value}`,
                                            `${object.loc[1]} ${object.loc[2]}`,
                                            d,
                                            inv
                                        ])
                                        .draw();
                                }

                            }

                            if (object.code == 20100105 && object.param.value >= $("#cvalue").val()) {
                                if ((object.loc[1] >= 616 && object.loc[2] <= 1175 && object.loc[1] <= 663 && object.loc[2] >= 1128) || (object.loc[1] >= 1128 && object.loc[2] <= 1431 && object.loc[1] <= 1175 && object.loc[2] >= 1384) || (object.loc[1] >= 1128 && object.loc[2] <= 1175 && object.loc[1] <= 1175 && object.loc[2] >= 1128) || (object.loc[1] >= 360 && object.loc[2] <= 1431 && object.loc[1] <= 407 && object.loc[2] >= 1384)) {
                                    //console.log(object.loc[1] + ":" + object.loc[2],object.level,"skipped")
                                }
                                else {

                                    type = "Crystal";
                                    let d = 0;
                                    let inv = 0;
                                    let coordidc = "";
                                    coordidc = object.loc[1] + ":" + object.loc[2];
                                    if (localStorage.getItem(coordidc) == 1) {
                                        inv = 1;
                                    }
                                    area = 0;
                                    if (1300 > object.loc[2]) {
                                        //area = 1;
                                    }
                                    if (inv == 0) {
                                        d = distance(x, y, object.loc[1], object.loc[2]);
                                        if (d < 300) {
                                            area = 0;
                                        }
                                        crystal.row
                                            .add([
                                                `${object.level}`,
                                                `${type}`,
                                                `${object.param.value}`,
                                                `${object.loc[1]} ${object.loc[2]}`,
                                                d,
                                                area
                                            ])
                                            .draw();
                                    }
                                }
                            }
                            //}
                        }
                        else {
                            if (object.occupied.shield != 1 && object.occupied.allianceTag != "GoL1" && (((object.code > 20100100 && object.code < 20100105) || (object.code > 20700600 && object.code <= 20700605)) && (ke == 1 || minepvp == 1 || object.occupied.id == playerid))) {

                                if (ke == 1 || object.occupied.id == playerid || object.loc[1] >= 360 && object.loc[2] <= 1431 && object.loc[1] <= 1687 && object.loc[2] >= 360) {
                                    if (ke == 1 || object.occupied.id == playerid || object.occupied.allianceTag != "GoL2" && object.occupied.allianceTag != "GoLf" && object.occupied.allianceTag != "SPW1" && object.occupied.allianceTag != "SPWf" && object.occupied.allianceTag != "YGG0" && object.occupied.allianceTag != "YGG1" && object.occupied.allianceTag != "Tama" && object.occupied.allianceTag != "JPN2" && object.occupied.allianceTag != "CvC1" && object.occupied.allianceTag != "FORE" && object.occupied.allianceTag != "onio" && object.occupied.allianceTag != "DeFi") {

                                        type = "Unknow"
                                        if (object.code == 20100101 || object.code == 20700601) {
                                            type = "Food"
                                        }
                                        if (object.code == 20100103 || object.code == 20700603) {
                                            type = "Stone"
                                        }
                                        if (object.code == 20100104 || object.code == 20700604) {
                                            type = "Gold"
                                        }
                                        if (object.code == 20100102 || object.code == 20700602) {
                                            type = "Wood"
                                        }
                                        let inv = 0;
                                        let coordidc = "";
                                        coordidc = object.loc[1] + ":" + object.loc[2];
                                        if (localStorage.getItem(coordidc) == 1) {
                                            inv = 1;
                                        }
                                        area = 0;
                                        if (821 > object.loc[1] && 1377 < object.loc[2]) {
                                            //area = 1;
                                        }
                                        if (inv == 0) {
                                            d = distance(x, y, object.loc[1], object.loc[2]);
                                            if (eco != 0) {
                                                mines.row
                                                    .add([
                                                        `${object.level}`,
                                                        `${type} OCCUPED ${object.occupied.allianceTag} ${object.occupied.name}`,
                                                        `${object.param.value}`,
                                                        `${object.loc[1]} ${object.loc[2]}`,
                                                        d,
                                                        area,
                                                    ])
                                                    .draw();
                                            }
                                        }
                                    }
                                }
                            }
                            if (object.occupied.shield != 1 && object.occupied.allianceTag != "GoL1" && object.code == 20100105 && object.param.value >= $("#cvalue").val() && (ke == 1 || minepvp == 1) || object.occupied.id == playerid) {
                                if (ke == 1 || object.occupied.id == playerid || object.loc[1] >= 360 && object.loc[2] <= 1431 && object.loc[1] <= 1687 && object.loc[2] >= 360) {
                                    if (ke == 1 || object.occupied.id == playerid || object.occupied.allianceTag != "GoL2" && object.occupied.allianceTag != "GoLf" && object.occupied.allianceTag != "SPW1" && object.occupied.allianceTag != "SPWf" && object.occupied.allianceTag != "YGG0" && object.occupied.allianceTag != "YGG1" && object.occupied.allianceTag != "Tama" && object.occupied.allianceTag != "JPN2" && object.occupied.allianceTag != "CvC1" && object.occupied.allianceTag != "FORE" && object.occupied.allianceTag != "onio" && object.occupied.allianceTag != "DeFi") {


                                        type = "Crystal";
                                        let d = 0;
                                        let inv = 0;
                                        let coordidc = "";
                                        coordidc = object.loc[1] + ":" + object.loc[2];
                                        if (localStorage.getItem(coordidc) == 1) {
                                            inv = 1;
                                            console.log(coordidc)
                                        }
                                        area = 0;
                                        if (1300 > object.loc[2]) {
                                            //area = 1;
                                        }
                                        if (inv == 0) {
                                            d = distance(x, y, object.loc[1], object.loc[2]);

                                            crystal.row
                                                .add([
                                                    `${object.level}`,
                                                    `${type} OCCUPED ${object.occupied.allianceTag} ${object.occupied.name}`,
                                                    `${object.param.value}`,
                                                    `${object.loc[1]} ${object.loc[2]}`,
                                                    d,
                                                    area
                                                ])
                                                .draw();
                                        }
                                    }
                                }
                            }
                            if (object.code == 20300101 && object.level > playerlvl && ((object.loc[1] >= 360 && object.loc[2] <= 1431 && object.loc[1] <= 1687 && object.loc[2] >= 360) || object.occupied.allianceTag == "undefined")) {
                                if (object.occupied.allianceTag != "GoL1" && object.occupied.allianceTag != "GoL2" && object.occupied.allianceTag != "GoLf" && object.occupied.allianceTag != "SPW1" && object.occupied.allianceTag != "SPWf" && object.occupied.allianceTag != "YGG0" && object.occupied.allianceTag != "YGG1" && object.occupied.allianceTag != "Tama" && object.occupied.allianceTag != "JPN2" && object.occupied.allianceTag != "CvC1" && object.occupied.allianceTag != "FORE" && object.occupied.allianceTag != "onio" && object.occupied.allianceTag != "DeFi") {
                                    let d = 0;
                                    d = distance(x, y, object.loc[1], object.loc[2]);
                                    //setTimeout(() => kills(object.occupied.id),1000)
                                    //if (d < 200) {

                                    let type = "";
                                    let value = 0;
                                    shield = "No Shield";
                                    if (object.occupied.shield == 1) {
                                        shield = "Shield";

                                    }
                                    players.row
                                        .add([
                                            `${object.level}`,
                                            `${object.occupied.name}`,
                                            `${object.occupied.allianceTag}`,
                                            `${object.occupied.id}`,
                                            `${object.loc[1]} ${object.loc[2]}`,
                                            shield,
                                            d
                                        ])
                                        .draw();
                                    //}
                                }
                            }

                            if ((object.code == 20600101 || object.code == 20300101) && mapRefresh == 1) { //players

                                ccx = object.loc[1]
                                ccy = object.loc[2]
                                coordid = ccx + ":" + ccy;
                                localStorage.setItem(coordid, 1);
                                if ("1006:1405" == coordid) {
                                    console.log("Ajout joueur:", coordid)
                                }

                                ccx += 1
                                coordid = ccx + ":" + ccy;
                                localStorage.setItem(coordid, 1);
                                if ("1006:1405" == coordid) {
                                    console.log("Ajout joueur2:", coordid)
                                }

                                ccy += 1
                                coordid = ccx + ":" + ccy;
                                localStorage.setItem(coordid, 1);
                                if ("1006:1405" == coordid) {
                                    console.log("Ajout joueur3:", coordid)
                                }
                                ccx = object.loc[1]
                                coordid = ccx + ":" + ccy;
                                localStorage.setItem(coordid, 1);

                                if ("1006:1405" == coordid) {
                                    console.log("Ajout joueur4:", coordid)
                                }
                            }

                        }

                    });
                }
            }
            const distance = (lat1, lon1, lat2, lon2) => {
                const a = lat1 - lat2;
                const b = lon1 - lon2;
                return Math.round(Math.sqrt(a * a + b * b));

            };
            function save() {
                if ($("#x").val() && $("#y").val()) {
                    localStorage.setItem('x', JSON.stringify($("#x").val()));
                    localStorage.setItem('y', JSON.stringify($("#y").val()));
                    $("#cx").val($("#x").val())
                    $("#cy").val($("#y").val())
                    localStorage.setItem('slots', $("#slots").val());
                    localStorage.setItem('token', $("#token").val());
                    localStorage.setItem('dist', $("#dist").val());

                }
            }
            $("#saveSetup").click(function () {
                save();
            });
            $("#clear").click(function () {
                localStorage.clear();
                save()
                mapRefresh = 1;
            });
            $("#find").click(function () {
                tw = 200;
                if (ws == 0 && webSocket.readyState == webSocket.OPEN) {
                    webSocket.close()
                }
                if (ws1 == 0 && webSocket1.readyState == webSocket1.OPEN) {
                    webSocket1.close()
                }
                if (ws2 == 0 && webSocket2.readyState == webSocket2.OPEN) {
                    webSocket2.close()
                }
                if (ws3 == 0 && webSocket3.readyState == webSocket3.OPEN) {
                    webSocket3.close()
                }
                if (ws4 == 0 && webSocket4.readyState == webSocket4.OPEN) {
                    webSocket4.close()
                }
                if (ws5 == 0 && webSocket5.readyState == webSocket5.OPEN) {
                    webSocket5.close()
                }
                if (ws6 == 0 && webSocket6.readyState == webSocket6.OPEN) {
                    webSocket6.close()
                }
                if (ws7 == 0 && webSocket7.readyState == webSocket7.OPEN) {
                    webSocket7.close()
                }
                if (ws8 == 0 && webSocket8.readyState == webSocket8.OPEN) {
                    webSocket8.close()
                }
                if (ws9 == 0 && webSocket9.readyState == webSocket9.OPEN) {
                    webSocket9.close()
                }
                ws = 0; ws1 = 0; ws2 = 0; ws3 = 0; ws4 = 0; ws5 = 0; ws6 = 0; ws7 = 0; ws8 = 0; ws9 = 0;
                checkWS();
                mapRefresh = 0;
                ClearTables()
                j = 0;

                t = 8;
                zonet = document.getElementsByName('zonetype');
                if (zonet[0].checked) {
                    i = 1999;
                    m = 4070;
                    tw = 200;
                    maptime = Math.floor(Date.now() / 1000) - updateMap
                    if (updateMap === 0 || maptime > 2100000000) {

                        updateMap = Math.floor(Date.now() / 1000)

                        localStorage.clear(); console.log("Clear database, new scan ")
                        save()
                        localStorage.setItem('updateMap', updateMap);
                        mapRefresh = 1;
                    }
                }
                if (zonet[1].checked) {
                    tw = 200;
                    i = 1600
                    m = 3000;
                }
                if (zonet[2].checked) {
                    tw = 300;
                    i = 1000
                    m = 3700;
                }
                if (zonet[3].checked) {
                    tw = 400;
                    i = 1;
                    m = 4090;
                    maptime = Math.floor(Date.now() / 1000) - updateMap
                    if (updateMap === 0 || maptime > 2100000000) {

                        updateMap = Math.floor(Date.now() / 1000)

                        localStorage.clear(); console.log("Clear database, new scan ")
                        save()
                        localStorage.setItem('updateMap', updateMap);
                        mapRefresh = 1;
                    }
                }
                let zones = new Array(t);
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                zonesA = JSON.stringify(zones);
                //
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)
                webSocket.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                $("#j").val(++j);
                setTimeout("sendZones();", tw);
                setTimeout("sendZones2();", tw);
                setTimeout("sendZones3();", tw);
                setTimeout("sendZones4();", tw);
                setTimeout("sendZones5();", tw);
                setTimeout("sendZones6();", tw);
                setTimeout("sendZones7();", tw);
                setTimeout("sendZones8();", tw);
                setTimeout("sendZones9();", tw);
                setTimeout("sendZones1();", tw);
            });
            function auto() {
                return
                checkRally()
                setTimeout("helpAll();", 5000);
                setTimeout("reloadAP();", 8000);

                //reloadAP()
                console.log("Auto reload.")
                zonet = document.getElementsByName('zonetype');
                if (!zonet[0].checked) return
                time = 0;
                i = 3700
                m = 1000;
                checkWS();

                ClearTables();
                j = 0;
                let zones = new Array(t);
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                zonesA = JSON.stringify(zones);
                //console.log("zones :", zonesA);
                webSocket.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                $("#j").val(++j);
                t = 8;
                i = 2700
                m = 700;
                setTimeout("sendZones();", tw);

            }
            function find() {
                document.getElementById("find").innerHTML = "Scanning map...";

            }
            function timereset() {
                timer = 0;
            }
            function autoClear() {
                $("#dist").val(0)
                fieldslot = [];
                localStorage.clear();
                save()
                location.reload();
            }
            function initWS(n) {
                let tok = localStorage.getItem('token')
                if (n.readyState === n.CLOSED) {
                    checkWS();
                }
                else {
                    if (n.readyState === n.OPEN) {

                        n.send(
                            `42["/field/enter", {"token":"${tok}"}]`
                        );
                    }
                    if (n.readyState === n.CONNECTING) {
                        setTimeout("initWS(n);", 2000);
                    }
                }
            }
            function checkWS() {
                return
                if (webSocket.readyState === webSocket.CLOSED) {
                    webSocket = new WebSocket(
                        "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
                    );
                    ////setTimeout("initWS(webSocket);", 3000);

                }

            }
            function sendZones() {
                if (i >= m) { /*if (zonet[0].checked) { setTimeout("auto();", 10000); };*/ return; }
                checkWS();
                if (webSocket.readyState != webSocket.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                )
                setTimeout(() =>
                    webSocket.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones();", tw);
            }
            function sendZones2() {
                if (i >= m) { /*if (zonet[0].checked) { setTimeout("auto();", 10000); };*/ return; }
                checkWS();
                if (webSocket2.readyState != webSocket2.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket2.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                )
                setTimeout(() =>
                    webSocket2.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones2();", tw);
            }
            function sendZones3() {
                if (i >= m) return
                checkWS();
                if (webSocket3.readyState != webSocket3.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones3 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)
                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket3.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket3.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones3();", tw);
            }
            function sendZones4() {
                if (i >= m) return
                checkWS();
                if (webSocket4.readyState != webSocket4.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones4 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket4.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket4.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones4();", tw);
            }
            function sendZones5() {
                if (i >= m) return
                checkWS();
                if (webSocket5.readyState != webSocket5.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //("zones5 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket5.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket5.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones5();", tw);
            }
            function sendZones6() {
                if (i >= m) return
                checkWS();
                if (webSocket6.readyState != webSocket6.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones6 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket6.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket6.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones6();", tw);
            }
            function sendZones1() {
                if (i >= m) return
                checkWS();
                if (webSocket1.readyState != webSocket1.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones1 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket1.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket1.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones1();", tw);
            }
            function sendZones7() {
                if (i >= m) return
                checkWS();
                if (webSocket7.readyState != webSocket7.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones7 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket7.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket7.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones7();", tw);
            }
            function sendZones8() {
                if (i >= m) return
                checkWS();
                if (webSocket8.readyState != webSocket8.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones8 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket8.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket8.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones8();", tw);
            }
            function sendZones9() {
                if (i >= m) return
                checkWS();
                if (webSocket9.readyState != webSocket9.OPEN) { return }
                for (let b = 0; b <= t; b++) {
                    i += 1;
                    zones[b] = i;
                }
                //for (let w = 0; w <= 4000; w++) {
                //console.log("zones9 :", JSON.stringify(zones));
                //}
                let coded = `{"world":1, "zones":"${zonesA}"}`
                //coded = btoa(coded)

                zonesA = JSON.stringify(zones);
                coded = `{"world":1, "zones":"${zonesA}"}`
                $("#count").val(i);
                webSocket9.send(
                    `42["/zone/enter/list/v2", ${coded}]`
                );
                setTimeout(() =>
                    webSocket9.send(
                        `42["/zone/leave/list/v2", ${coded}]`
                    )
                    , 1009)
                lastResponse = Math.floor(Date.now() / 1000)
                setTimeout("sendZones9();", tw);
            }
            function ClearTables() {
                $('#charm').DataTable().clear().draw();
                $('#dk').DataTable().clear().draw();
                $('#crystal').DataTable().clear().draw();
                $('#mine').DataTable().clear().draw();
                $('#goblin').DataTable().clear().draw();
                $('#player').DataTable().clear().draw();
                $('#monster').DataTable().clear().draw();

            }
            function keepConnect() {
                checkWS();
                if (webSocket.readyState == webSocket.OPEN) {
                    webSocket.send(`2`);
                }
                if (webSocket2.readyState == webSocket2.OPEN) {
                    webSocket2.send(`2`);
                }
                if (webSocket3.readyState == webSocket3.OPEN) {
                    webSocket3.send(`2`);
                }
                if (webSocket4.readyState == webSocket4.OPEN) {
                    webSocket4.send(`2`);
                }
                if (webSocket5.readyState == webSocket5.OPEN) {
                    webSocket5.send(`2`);
                }
                if (webSocket6.readyState == webSocket6.OPEN) {
                    webSocket6.send(`2`);
                }
                if (webSocket7.readyState == webSocket7.OPEN) {
                    webSocket7.send(`2`);
                }
                if (webSocket8.readyState == webSocket8.OPEN) {
                    webSocket8.send(`2`);
                }
                if (webSocket9.readyState == webSocket9.OPEN) {
                    webSocket9.send(`2`);
                }
                if (webSocket1.readyState == webSocket1.OPEN) {
                    webSocket1.send(`2`);
                }

                if (Math.floor(Date.now() / 1000 - lastResponse) > 3) {
                    document.getElementById("find").innerHTML = "Find";
                }
                keepid = setTimeout("keepConnect()", 10000);
            }
            /*if (webSocket.readyState === webSocket.CLOSED) {
                    webSocket = new WebSocket(
                    "wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket"
                    );
                }
                
        if (webSocket.readyState === webSocket.CONNECTING) {
            console.log("Connecting...")
        }
        if (webSocket.readyState === webSocket.OPEN) {
            console.log("OPEN...")
        } 20400301 shrine
        20400101 congres
        */
            function getMarch(id, x, y, w) {
                return

                rallytime = 0;

                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "fromId": id, "toLoc": [w, x, y] }))

                return fetch('https://api-lok-live.leagueofkingdoms.com/api/field/march/info',
                    {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": $("#token").val(),
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": `${jsoncmd}`,
                        "method": "POST"
                    })
                    .then((response) => response.json())
                    .then((responseData) => {
                        //console.log(responseData);
                        return responseData;
                    })
                    .catch(error => console.warn(error));
            }

            function field() {
                return fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/task/all", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val()
                    },
                    "referrer": "https://play.leagueofkingdoms.com/",
                    "referrerPolicy": "strict-origin-when-cross-origin",
                    "body": "json=%7B%7D",
                    "method": "POST",
                    "mode": "cors",
                    "credentials": "omit"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        //console.log(responseData.fieldTasks.length, responseData.fieldTasks);
                        if (responseData.fieldTasks.length == 1) {
                            if (responseData.fieldTasks[0].code == 2 || responseData.fieldTasks[0].code == 5) {
                                fieldslot.push(responseData.fieldTasks[0].param.toLoc[1] + ":" + responseData.fieldTasks[0].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[0].param.foLoc[1] + ":" + responseData.fieldTasks[0].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 2) {
                            if (responseData.fieldTasks[1].code == 2 || responseData.fieldTasks[1].code == 5) {
                                fieldslot.push(responseData.fieldTasks[1].param.toLoc[1] + ":" + responseData.fieldTasks[1].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[1].param.foLoc[1] + ":" + responseData.fieldTasks[1].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 3) {
                            if (responseData.fieldTasks[2].code == 2 || responseData.fieldTasks[2].code == 5) {
                                fieldslot.push(responseData.fieldTasks[2].param.toLoc[1] + ":" + responseData.fieldTasks[2].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[2].param.foLoc[1] + ":" + responseData.fieldTasks[2].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 4) {
                            if (responseData.fieldTasks[3].code == 2 || responseData.fieldTasks[3].code == 5) {
                                fieldslot.push(responseData.fieldTasks[3].param.toLoc[1] + ":" + responseData.fieldTasks[3].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[3].param.foLoc[1] + ":" + responseData.fieldTasks[3].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 5) {
                            if (responseData.fieldTasks[4].code == 2 || responseData.fieldTasks[4].code == 5) {
                                fieldslot.push(responseData.fieldTasks[4].param.toLoc[1] + ":" + responseData.fieldTasks[4].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[4].param.foLoc[1] + ":" + responseData.fieldTasks[4].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 6) {
                            if (responseData.fieldTasks[5].code == 2 || responseData.fieldTasks[5].code == 5) {
                                fieldslot.push(responseData.fieldTasks[5].param.toLoc[1] + ":" + responseData.fieldTasks[5].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[5].param.foLoc[1] + ":" + responseData.fieldTasks[5].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 7) {
                            if (responseData.fieldTasks[6].code == 2 || responseData.fieldTasks[6].code == 5) {
                                fieldslot.push(responseData.fieldTasks[6].param.toLoc[1] + ":" + responseData.fieldTasks[6].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[6].param.foLoc[1] + ":" + responseData.fieldTasks[6].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 8) {
                            if (responseData.fieldTasks[7].code == 2 || responseData.fieldTasks[7].code == 5) {
                                fieldslot.push(responseData.fieldTasks[7].param.toLoc[1] + ":" + responseData.fieldTasks[7].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[7].param.foLoc[1] + ":" + responseData.fieldTasks[7].param.foLoc[2]);
                            }
                        }
                        if (responseData.fieldTasks.length == 9) {
                            if (responseData.fieldTasks[8].code == 2 || responseData.fieldTasks[8].code == 5) {
                                fieldslot.push(responseData.fieldTasks[8].param.toLoc[1] + ":" + responseData.fieldTasks[8].param.toLoc[2]);
                            }
                            else {
                                fieldslot.push(responseData.fieldTasks[8].param.foLoc[1] + ":" + responseData.fieldTasks[8].param.foLoc[2]);
                            }
                        }



                        return responseData.fieldTasks.length;
                    })
                //.catch(error => console.warn(error));
            }
            function sendCrystal(cx, cy, CavAmount, slot, ArcAmount, world) {


                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "fromId": "61e5b797247cf2106a722691", "marchType": 1, "toLoc": [world, cx, cy], "marchTroops": [{ "code": 50100101, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100201, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100301, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100102, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100103, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100104, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100204, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100304, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100205, "level": 0, "select": 0, "amount": ArcAmount, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100305, "level": 0, "select": 0, "amount": CavAmount, "dead": 0, "wounded": 0, "seq": 0 }] }))
                return fetch("https://api-lok-live.leagueofkingdoms.com/api/field/march/start", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result && responseData.numMarch <= $("#slots").val()) {
                            setTimeout("field();", 1000);

                            console.log(">>> Slots : ", slot, "/", $("#slots").val(), cx, cy, "time :", time)
                        }
                        else {
                            console.log("erreur mine : ", responseData);
                        }

                        setTimeout(() => checkRally(), 2000)

                    });

            }
            //setTimeout("auto();", 10000);
            function checkRally(r) {
                if (Math.floor(Date.now() / 1000 - lastrallycheck) < 10 || r == 1) return
                lastrallycheck = Math.floor(Date.now() / 1000);
                rallytime = 5000;
                return fetch("https://api-lok-live.leagueofkingdoms.com/api/alliance/battle/list", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": "json=%7B%7D",
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        //console.log(responseData.battles)
                        if (responseData.battles == null || responseData.battles == undefined) return
                        let l = responseData.battles.length
                        if (l == 0) return
                        while (l > 0) {
                            l -= 1;
                            //console.log(responseData.battles)
                            if (responseData.battles[l].targetMonster != null) {
                                //console.log(responseData.battles, responseData.battles[l].isRally, responseData.battles[l].isJoined, responseData.battles[l].targetMonster.code, responseData.battles[l].toLoc[1], responseData.battles[l].toLoc[2], responseData.battles[l].fromLoc[1], responseData.battles[l].fromLoc[2], responseData.battles[l]._id,rallytime);
                            }
                            if (responseData.battles[l].targetMonster != null && responseData.battles[l].state == 4 && responseData.battles[l].isBF && responseData.battles[l].targetMonster.code == 20700506 && responseData.battles[l].targetMonster.level >= 7 && responseData.battles[l].isRally && !responseData.battles[l].isJoined && !rallyJoined.includes(responseData.battles[l].toLoc[1] + ":" + responseData.battles[l].toLoc[2])) {
                                let amountCav = 50000;
                                d = distance($("#x").val(), $("#y").val(), responseData.battles[l].fromLoc[1], responseData.battles[l].fromLoc[2]);
                                ddest = distance($("#x").val(), $("#y").val(), responseData.battles[l].toLoc[1], responseData.battles[l].toLoc[2]);
                                //console.log(d,ddest)
                                if (d < 350 && ddest <= 400) {
                                    //rallyJoined.push(responseData.battles[l].toLoc[1] + ":" + responseData.battles[l].toLoc[2]);
                                    //console.log(responseData.battles, responseData.battles[l].isRally, responseData.battles[l].isJoined, responseData.battles[l].targetMonster.code, responseData.battles[l].toLoc[1], responseData.battles[l].toLoc[2], responseData.battles[l].fromLoc[1], responseData.battles[l].fromLoc[2], responseData.battles[l]._id,rallytime);
                                    setTimeout(() => joinRally(responseData.battles[l]._id, amountCav, responseData.battles[l].toLoc[1], responseData.battles[l].toLoc[2]), rallytime)
                                    reloadAP()
                                    return
                                }
                            }
                        }

                    });
            }
            function checkAP() {
                return fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/profile/my", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": "json=%7B%7D",
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.profile == null || responseData.profile == undefined) return
                        ap = responseData.profile.actionPoint.value;
                        //console.log(responseData.profile.actionPoint.value)
                    });

            }
            function reloadAP() {
                if (Math.floor(Date.now() / 1000 - lastapcheck) < 2) return
                lastapcheck = Math.floor(Date.now() / 1000);
                checkAP()

                if (ap < 50 && ap != 0) {
                    jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "code": item, "amount": 1 }))

                    return fetch("https://api-lok-live.leagueofkingdoms.com/api/item/use", {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": $("#token").val(),
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": `${jsoncmd}`,
                        "method": "POST"
                    })
                        .then((response) => response.json())
                        .then((responseData) => {
                            if (item == 10101052 && responseData.result) {
                                ap += 100;
                                console.log("AP reloading :", ap, "added 100ap",)
                                if (ap > 50) return
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101052 && !responseData.result) {
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101051 && responseData.result) {
                                ap += 50;
                                console.log("AP reloading :", ap, "added 50ap",)
                                if (ap > 50) return
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101051 && !responseData.result) {
                                item = 10101052;
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101050 && responseData.result) {
                                ap += 20;
                                console.log("AP reloading :", ap, "added 20ap",)
                                if (ap > 50) return
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101050 && !responseData.result) {
                                item = 10101051;
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101049 && responseData.result) {
                                ap += 10;
                                console.log("AP reloading :", ap, "addedd 10ap",)
                                if (ap > 50) return
                                setTimeout(() => reloadAP(), 2000)
                            }
                            if (item == 10101049 && !responseData.result) {
                                item = 10101050;
                                setTimeout(() => reloadAP(), 2000)
                            }





                        });
                } else { item = 10101049; }
            }
            //{"marchTroops":[{"code":50100205,"level":0,"select":0,"amount":0,"dead":0,"wounded":0,"seq":0},{"code":50100305,"level":0,"select":0,"amount":1000,"dead":0,"wounded":0,"seq":0},{"code":50100104,"level":0,"select":0,"amount":0,"dead":0,"wounded":0,"seq":0},{"code":50100204,"level":0,"select":0,"amount":0,"dead":0,"wounded":0,"seq":0},{"code":50100304,"level":0,"select":0,"amount":0,"dead":0,"wounded":0,"seq":0}],"rallyMoId":"6253ca6c5aa83815fe3d0bb3"}
            function joinRally(id, amountCav, rx, ry) {

                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "marchTroops": [{ "code": 50100205, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100305, "level": 0, "select": 0, "amount": amountCav, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100104, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100204, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }, { "code": 50100304, "level": 0, "select": 0, "amount": 0, "dead": 0, "wounded": 0, "seq": 0 }], "rallyMoId": id }))
                return fetch("https://api-lok-live.leagueofkingdoms.com/api/field/rally/join", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {
                            rallyJoined.push(rx + ":" + ry);
                            console.log("Rally : ", rx, ry);
                        }
                        else {
                            console.log("erreur rally : ", responseData);
                        }

                        setTimeout(() => checkRally(), 2000)

                    });
            }
            function helpAll() {
                if (Math.floor(Date.now() / 1000 - lasthelpcheck) < 600) return
                lasthelpcheck = Math.floor(Date.now() / 1000);
                console.log("Helping...")
                fetch("https://api-lok-live.leagueofkingdoms.com/api/alliance/help/all", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"98\", \"Opera GX\";v=\"84\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": "json=%7B%7D",
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {
                            console.log("Help All done")
                        }
                        else {
                            console.log("erreur help : ", responseData);
                        }



                    });
                harvest();
            }
            function harvest() {
                return
                if (Math.floor(Date.now() / 1000 - lastharvestcheck) < 10000) return
                lastharvestcheck = Math.floor(Date.now() / 1000);
                console.log("Harvesting...")
                setTimeout(() =>
                    fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/resource/harvest", {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr,en;q=0.9",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5M2YiLCJraW5nZG9tSWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5NDAiLCJ2ZXJzaW9uIjoxNDI2LCJ0aW1lIjoxNjQ5Nzk0OTY0MDY1LCJpYXQiOjE2NDk3OTQ5NjQsImV4cCI6MTY1MDM5OTc2NCwiaXNzIjoibm9kZ2FtZXMuY29tIiwic3ViIjoidXNlckluZm8ifQ.6tEPcGqwQZy1pxPjbyzlRM5X4Mf3uFDl3HOmDB8Jyag",
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": "json=%7B%22position%22%3A103%7D",
                        "method": "POST"
                    })

                    , 2000)

                setTimeout(() =>
                    fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/resource/harvest", {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr,en;q=0.9",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5M2YiLCJraW5nZG9tSWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5NDAiLCJ2ZXJzaW9uIjoxNDI2LCJ0aW1lIjoxNjQ5Nzk0OTY0MDY1LCJpYXQiOjE2NDk3OTQ5NjQsImV4cCI6MTY1MDM5OTc2NCwiaXNzIjoibm9kZ2FtZXMuY29tIiwic3ViIjoidXNlckluZm8ifQ.6tEPcGqwQZy1pxPjbyzlRM5X4Mf3uFDl3HOmDB8Jyag",
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": "json=%7B%22position%22%3A102%7D",
                        "method": "POST"
                    })

                    , 5000)

                setTimeout(() =>
                    fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/resource/harvest", {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr,en;q=0.9",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5M2YiLCJraW5nZG9tSWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5NDAiLCJ2ZXJzaW9uIjoxNDI2LCJ0aW1lIjoxNjQ5Nzk0OTY0MDY1LCJpYXQiOjE2NDk3OTQ5NjQsImV4cCI6MTY1MDM5OTc2NCwiaXNzIjoibm9kZ2FtZXMuY29tIiwic3ViIjoidXNlckluZm8ifQ.6tEPcGqwQZy1pxPjbyzlRM5X4Mf3uFDl3HOmDB8Jyag",
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": "json=%7B%22position%22%3A101%7D",
                        "method": "POST"
                    })

                    , 9000)

                setTimeout(() =>
                    fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/resource/harvest", {
                        "headers": {
                            "accept": "*/*",
                            "accept-language": "fr,en;q=0.9",
                            "content-type": "application/x-www-form-urlencoded",
                            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\"",
                            "sec-ch-ua-mobile": "?0",
                            "sec-ch-ua-platform": "\"Windows\"",
                            "sec-fetch-dest": "empty",
                            "sec-fetch-mode": "cors",
                            "sec-fetch-site": "same-site",
                            "x-access-token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5M2YiLCJraW5nZG9tSWQiOiI2MWU1NTk2N2ZlZjIwMTJmODc0N2M5NDAiLCJ2ZXJzaW9uIjoxNDI2LCJ0aW1lIjoxNjQ5Nzk0OTY0MDY1LCJpYXQiOjE2NDk3OTQ5NjQsImV4cCI6MTY1MDM5OTc2NCwiaXNzIjoibm9kZ2FtZXMuY29tIiwic3ViIjoidXNlckluZm8ifQ.6tEPcGqwQZy1pxPjbyzlRM5X4Mf3uFDl3HOmDB8Jyag",
                            "Referer": "https://play.leagueofkingdoms.com/",
                            "Referrer-Policy": "strict-origin-when-cross-origin"
                        },
                        "body": "json=%7B%22position%22%3A108%7D",
                        "method": "POST"
                    })

                    , 14000)

            }

            function track() {
                members("61e0854ec2da8511aa78fcff")
                members("61d288f2f8777c3f5d77a5d4")
                members("61dd3f52cf78261127a3de1f")
                members("61d892af2b18d81007b0df94")
                members("61d46d77f5d1d710f56802db")
                members("61d5b9455f787410603e9736")
                members("61d241f12d8f553d30f70c53")

            }
            function members(id) {
                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "allianceId": id }))
                fetch("https://api-lok-live.leagueofkingdoms.com/api/alliance/members/list", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Opera GX\";v=\"85\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {
                            kills(responseData.members[0].members[0].kingdomId)
                            for (let i = 0; i < responseData.members[1].members.length; i++) {
                                kills(responseData.members[1].members[i].kingdomId)
                            }
                            for (let i = 0; i < responseData.members[2].members.length; i++) {
                                kills(responseData.members[2].members[i].kingdomId)
                            }
                            for (let i = 0; i < responseData.members[3].members.length; i++) {
                                kills(responseData.members[3].members[i].kingdomId)
                            }
                            for (let i = 0; i < responseData.members[4].members.length; i++) {
                                kills(responseData.members[4].members[i].kingdomId)
                            }


                        }
                        else {
                            console.log("erreur kills : ", responseData);
                        }



                    });
            }
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            function kills(id) {
                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "kingdomId": id }))
                fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/profile/other", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Opera GX\";v=\"85\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {
                            //console.log(responseData.profile.kill,"	",responseData.profile.name,"	",responseData.profile.alliance.name,"	",responseData.profile.power,"	",responseData.profile.level,"	",responseData.profile.lord.level,"	",responseData.profile._id)
                            speedCheck(id, responseData.profile.name)
                            MasteryCheck(id, responseData.profile.name)
                        }
                        else {
                            console.log("erreur kills : ", responseData);
                        }



                    });
            }
            function speedCheck(id, kingdom) {
                let speed = 0;
                //{"result":true,"equipped":[{"slot":0,"item":{"_id":"61ec1d235d150e12e5eec1a1","code":10504002,"amount":1,"piece":19,"level":1,"skillLevel":[5,2,0,0,0],"equipped":true}},{"slot":1,"item":{"_id":"61f6dba5fff5105aa5775abc","code":10503025,"amount":1,"piece":13,"level":3,"skillLevel":[5,5,3,5,0],"equipped":true}},{"slot":2,"item":{"_id":"625371b4ecbda63381e90efb","code":10504013,"amount":1,"piece":96,"level":5,"skillLevel":[5,5,5,5,5],"equipped":true}},{"slot":3,"item":{"_id":"61e735e15d150e12e52f36f1","code":10503013,"amount":1,"piece":25,"level":3,"skillLevel":[5,5,5,3,0],"equipped":true}},{"slot":4,"item":{"_id":"61e735e55d150e12e530bcb6","code":10502010,"amount":1,"piece":783,"level":3,"skillLevel":[5,5,5,0,0],"equipped":true}},{"slot":5,"item":{"_id":"61e7024e5d150e12e51acf17","code":10504001,"amount":1,"piece":411,"level":5,"skillLevel":[5,5,5,5,5],"equipped":true}}]}
                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "kingdomId": id }))
                fetch("https://api-lok-live.leagueofkingdoms.com/api/kingdom/treasure/list", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr,en;q=0.9",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"102\", \"Google Chrome\";v=\"102\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {
                            //console.log(responseData.equipped[0].item.code)
                            if (responseData.equipped[0].item.code == 10504002 || responseData.equipped[1].item.code == 10504002 || responseData.equipped[2].item.code == 10504002 || responseData.equipped[3].item.code == 10504002 || responseData.equipped[4].item.code == 10504002 || responseData.equipped[5].item.code == 10504002) {
                                speed = 1;
                            }
                            if (responseData.equipped[0].item.code == 10503025 || responseData.equipped[1].item.code == 10503025 || responseData.equipped[2].item.code == 10503025 || responseData.equipped[3].item.code == 10503025 || responseData.equipped[4].item.code == 10503025 || responseData.equipped[5].item.code == 10503025) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10504013 || responseData.equipped[1].item.code == 10504013 || responseData.equipped[2].item.code == 10504013 || responseData.equipped[3].item.code == 10504013 || responseData.equipped[4].item.code == 10504013 || responseData.equipped[5].item.code == 10504013) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10503013 || responseData.equipped[1].item.code == 10503013 || responseData.equipped[2].item.code == 10503013 || responseData.equipped[3].item.code == 10503013 || responseData.equipped[4].item.code == 10503013 || responseData.equipped[5].item.code == 10503013) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10502010 || responseData.equipped[1].item.code == 10502010 || responseData.equipped[2].item.code == 10502010 || responseData.equipped[3].item.code == 10502010 || responseData.equipped[4].item.code == 10502010 || responseData.equipped[5].item.code == 10502010) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10503001 || responseData.equipped[1].item.code == 10503001 || responseData.equipped[2].item.code == 10503001 || responseData.equipped[3].item.code == 10503001 || responseData.equipped[4].item.code == 10503001 || responseData.equipped[5].item.code == 10503001) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10503016 || responseData.equipped[1].item.code == 10503016 || responseData.equipped[2].item.code == 10503016 || responseData.equipped[3].item.code == 10503016 || responseData.equipped[4].item.code == 10503016 || responseData.equipped[5].item.code == 10503016) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10503009 || responseData.equipped[1].item.code == 10503009 || responseData.equipped[2].item.code == 10503009 || responseData.equipped[3].item.code == 10503009 || responseData.equipped[4].item.code == 10503009 || responseData.equipped[5].item.code == 10503009) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10502015 || responseData.equipped[1].item.code == 10502015 || responseData.equipped[2].item.code == 10502015 || responseData.equipped[3].item.code == 10502015 || responseData.equipped[4].item.code == 10502015 || responseData.equipped[5].item.code == 10502015) {
                                speed += 1;
                            }
                            if (responseData.equipped[0].item.code == 10502011 || responseData.equipped[1].item.code == 10502011 || responseData.equipped[2].item.code == 10502011 || responseData.equipped[3].item.code == 10502011 || responseData.equipped[4].item.code == 10502011 || responseData.equipped[5].item.code == 10502011) {
                                speed += 1;
                            }
                            if (speed < 5) {
                                console.log(kingdom, "	", speed);
                            }
                        }
                        else {
                            console.log("erreur speeds : ", responseData);
                        }



                    });
            }
            function MasteryCheck(id, kingdom) {
                let MasteryCav = 0;
                let MasteryCombat = 0;
                let MasteryMonster = 0;
                //{"result":true,"equipped":[{"slot":0,"item":{"_id":"61ec1d235d150e12e5eec1a1","code":10504002,"amount":1,"piece":19,"level":1,"skillLevel":[5,2,0,0,0],"equipped":true}},{"slot":1,"item":{"_id":"61f6dba5fff5105aa5775abc","code":10503025,"amount":1,"piece":13,"level":3,"skillLevel":[5,5,3,5,0],"equipped":true}},{"slot":2,"item":{"_id":"625371b4ecbda63381e90efb","code":10504013,"amount":1,"piece":96,"level":5,"skillLevel":[5,5,5,5,5],"equipped":true}},{"slot":3,"item":{"_id":"61e735e15d150e12e52f36f1","code":10503013,"amount":1,"piece":25,"level":3,"skillLevel":[5,5,5,3,0],"equipped":true}},{"slot":4,"item":{"_id":"61e735e55d150e12e530bcb6","code":10502010,"amount":1,"piece":783,"level":3,"skillLevel":[5,5,5,0,0],"equipped":true}},{"slot":5,"item":{"_id":"61e7024e5d150e12e51acf17","code":10504001,"amount":1,"piece":411,"level":5,"skillLevel":[5,5,5,5,5],"equipped":true}}]}
                jsoncmd = "json=" + encodeURIComponent(JSON.stringify({ "kingdomId": id }))
                fetch("https://api-lok-live.leagueofkingdoms.com/api/lord/mastery/dashboard", {
                    "headers": {
                        "accept": "*/*",
                        "accept-language": "fr,en;q=0.9",
                        "content-type": "application/x-www-form-urlencoded",
                        "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"102\", \"Google Chrome\";v=\"102\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"Windows\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "same-site",
                        "x-access-token": $("#token").val(),
                        "Referer": "https://play.leagueofkingdoms.com/",
                        "Referrer-Policy": "strict-origin-when-cross-origin"
                    },
                    "body": `${jsoncmd}`,
                    "method": "POST"
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        if (responseData.result) {

                            //console.log(responseData.equipped[0].item.code)
                            for (let i = 0; i < responseData.dashboard.groups.length; i++) {
                                if (responseData.dashboard.groups[i].group == 13) {
                                    MasteryCav = responseData.dashboard.groups[i].numPoint;
                                }
                                if (responseData.dashboard.groups[i].group == 14) {
                                    MasteryCombat = responseData.dashboard.groups[i].numPoint;
                                }
                                if (responseData.dashboard.groups[i].group == 15) {
                                    MasteryMonster = responseData.dashboard.groups[i].numPoint;
                                }
                            }
                            if (MasteryCav < 12 || responseData.dashboard.point > 0) {
                                console.log(kingdom, "	points free:	", responseData.dashboard.point, "	Cav:	", MasteryCav, "	Combat:	", MasteryCombat, "	Monster:	", MasteryMonster)
                            }
                        }
                        else {
                            console.log("erreur Mastery : ", responseData);
                        }



                    });
            }
        </script>
</body>

</html>